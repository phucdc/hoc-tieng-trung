{% extends "base.html" %} {% block title %}Home{% endblock %} {% block body %}
<button type="button" class="btn btn-primary" id="learn-btn">
  Learn selected
</button>
{% for tab in tabs %}
<button type="button" class="btn btn-outline-dark">{{ tab.name }}</button>
{% endfor %}
<br />
<br />
<br />
<table class="table">
  <thead>
    <tr>
      <th scope="col">
        <div class="form-check">
          <input class="form-check-input check-all" type="checkbox" />
        </div>
      </th>
      <th scope="col">#</th>
      <th scope="col">Hán tự</th>
      <th scope="col">Nghĩa</th>
    </tr>
  </thead>
  <tbody id="word-table-body">
    <tr>
      <th></th>
      <td>
        <button type="button" class="btn btn-success" id="add-word" disabled>
          Add
        </button>
      </td>
      <td>
        <input type="text" name="word" id="word-input" class="form-control" />
      </td>
      <td>
        <input
          type="text"
          name="meaning"
          id="meaning-input"
          class="form-control"
        />
      </td>
    </tr>
    {% for word in words %}
    <tr>
      <th>
        <div class="form-check">
          <input
            class="form-check-input check-item"
            type="checkbox"
            value="{{ word.id }}"
          />
        </div>
      </th>
      <td>{{ loop.index }}</td>
      <td>{{ word.word }}</td>
      <td>{{ word.meaning }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
  const checkAll = document.querySelector(".check-all");
  const checkItems = document.querySelectorAll(".check-item");
  const learnBtn = document.getElementById("learn-btn");
  const addWordBtn = document.getElementById("add-word");
  const wordInput = document.getElementById("word-input");
  const meaningInput = document.getElementById("meaning-input");
  const tableBody = document.getElementById("word-table-body");

  checkAll.addEventListener("change", function () {
    checkItems.forEach(function (checkbox) {
      checkbox.checked = checkAll.checked;
    });
  });

  learnBtn.addEventListener("click", function () {
    const word_ids = Array.from(checkItems)
      .filter((checkbox) => checkbox.checked)
      .map((checkbox) => checkbox.value);

    // Send the selected values to the server
    fetch("/learn", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ word_ids }),
    })
      .then((response) => response.text())
      .then((html) => {
        // Update the entire document with the rendered HTML
        document.documentElement.innerHTML = html;
      })
      .catch((error) => {
        // Handle any errors
        console.error(error);
      });
  });

  function validateInputs() {
    const word = wordInput.value.trim();
    const meaning = meaningInput.value.trim();

    if (word && meaning) {
      addWordBtn.disabled = false;
    } else {
      addWordBtn.disabled = true;
    }
  }

  wordInput.addEventListener("input", validateInputs);
  meaningInput.addEventListener("input", validateInputs);

  addWordBtn.addEventListener("click", function () {
    const word = wordInput.value.trim();
    const meaning = meaningInput.value.trim();

    fetch("/word/add", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ word, meaning }),
    })
      .then((response) => response.json())
      .then((data) => {
        // Create a new table row with the new word data
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
          <th>
            <div class="form-check">
              <input class="form-check-input check-item" type="checkbox" value="${
                data.id
              }">
            </div>
          </th>
          <td>${tableBody.querySelectorAll("tr").length}</td>
          <td>${data.word}</td>
          <td>${data.meaning}</td>
        `;

        // Append the new row to the table body
        tableBody.appendChild(newRow);

        // Clear the input fields
        wordInput.value = "";
        meaningInput.value = "";
        addWordBtn.disabled = true;
      })
      .catch((error) => {
        // Handle any errors
        console.error(error);
      });
  });
</script>
{% endblock %}
